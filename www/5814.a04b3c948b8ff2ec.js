"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5814],{7757:(R,P,l)=>{l.d(P,{E1:()=>I,fb:()=>V});var d=l(467),u=l(5351),f=l(3),A=l(177),v=l(7376),m=l(9893),h=l(9417),y=l(3719),p=l(2798),C=l(9631),g=l(5084),D=l(5951),O=l(2765),t=l(4438),_=l(9934),E=l(8023),M=l(9012);function S(s,c){if(1&s){const r=t.RV6();t.j41(0,"mat-option",22),t.bIt("click",function(){const i=t.eBV(r).$implicit,n=t.XpG();return t.Njj(n.getDoctors(i))}),t.EFF(1),t.k0s()}if(2&s){const r=c.$implicit;t.Y8G("value",r),t.R7$(),t.SpI(" ",r.name," ")}}function N(s,c){1&s&&(t.j41(0,"mat-error"),t.EFF(1,"This field is Required"),t.k0s())}function j(s,c){if(1&s){const r=t.RV6();t.j41(0,"mat-option",22),t.bIt("click",function(){const i=t.eBV(r).$implicit,n=t.XpG();return t.Njj(n.getDoctorsArray(i.specialityCode,i.specialityName))}),t.EFF(1),t.k0s()}if(2&s){const r=c.$implicit;t.Y8G("value",r),t.R7$(),t.SpI(" ",r.specialityName," ")}}function F(s,c){if(1&s){const r=t.RV6();t.j41(0,"mat-option",22),t.bIt("click",function(){const i=t.eBV(r).$implicit,n=t.XpG();return t.Njj(n.getCurrentDoctor(i))}),t.EFF(1),t.k0s()}if(2&s){const r=c.$implicit;t.Y8G("value",r),t.R7$(),t.SpI(" ",r.doctorName," ")}}function b(s,c){if(1&s){const r=t.RV6();t.j41(0,"mat-option",22),t.bIt("click",function(){const i=t.eBV(r).$implicit,n=t.XpG();return t.Njj(n.getTime(i.time))}),t.EFF(1),t.k0s()}if(2&s){const r=c.$implicit;t.Y8G("value",r),t.R7$(),t.SpI(" ",r.time," ")}}function k(s,c){1&s&&(t.j41(0,"mat-error"),t.EFF(1,"This field is Required"),t.k0s())}let I=(()=>{var s;class c{transform(e){return null!=e?v.uniqBy(e,"specialityName"):e}}return(s=c).\u0275fac=function(e){return new(e||s)},s.\u0275pipe=t.EJ8({name:"filter",type:s,pure:!0,standalone:!0}),c})();const B={parse:{dateInput:{month:"numeric",year:"numeric",day:"numeric"}},display:{dateInput:"input",monthYearLabel:{year:"numeric",month:"numeric"},dateA11yLabel:{year:"numeric",month:"numeric",day:"numeric"},monthYearA11yLabel:{year:"numeric",month:"numeric"}}};class U extends f.xW{format(c,r){return"input"===r?(0,A.Yq)(c,"dd/MM/yyyy",this.locale):c.toDateString()}}let V=(()=>{var s;class c{constructor(e,i,n,a,o){this.data=e,this.dialogRef=i,this.utilityService=n,this.httpService=a,this.router=o,this.timeSlotAfternoon=[],this.timeSlotMorning=[],this.timeSlotEvening=[],this.timeSlotNight=[],this.doctorSlots=[],this.isHiddenFees=!0,this.minAppointmentDate=new Date,this.getHospitals(),this.dateOfAppointment=this.data.appointmentDetails.appointmentDate,this.getTimeSlot(),"VID_CONS"===this.data.appointmentDetails.consultationCharge.code?this.videoConsultation=this.data.appointmentDetails.consultationCharge:this.consultation=this.data.appointmentDetails.consultationCharge,this.onChange(this.data.appointmentDetails.videoConsultation);let L={code:this.data.appointmentDetails.hospital.code,_id:this.data.appointmentDetails.hospital.id,name:this.data.appointmentDetails.hospital.name,paymentGatewayDetails:this.data.appointmentDetails.paymentDetails};this.getConsultationFee(this.data.appointmentDetails.doctorId,this.data.appointmentDetails.hospital.code),this.getDoctors(L)}getHospitals(){var e=this;return(0,d.A)(function*(){yield e.httpService.get("/hospital/?active=true").then(n=>{if(null!=n&&""!==n){e.hospitals=n;for(let a=0;a<e.hospitals.length;a++)e.hospitals[a].name===e.data.appointmentDetails.hospitalName&&(e.hospital=e.hospitals[a]);return n}}).catch(n=>{})})()}getSpecialists(e){var i=this;return(0,d.A)(function*(){i.hospitalCode=e.code,i.hospitalId=e._id,i.hospitalName=e.name;const n="/speciality/?hospitalCode="+i.hospitalCode;yield i.httpService.get(n).then(a=>{""!==a&&(i.specialityList=a.data.specialities);for(let o=0;o<i.specialityList.length;o++)i.specialityList[o].specialityName===i.data.appointmentDetails.specialityName&&(i.specialist=i.specialityList[o])}).catch(a=>{i.utilityService.presentAlert("Fetching Error","No specialty found.")})})()}getDoctors(e){var i=this;return(0,d.A)(function*(){i.hospitalCode=e.code,i.hospitalId=e._id,i.hospitalName=e.name,i.gateWayKey=e.paymentGatewayDetails.gatewayKey;const n="/doctor/?hospitalCode="+i.hospitalCode;yield i.httpService.get(n).then(a=>{if(a){i.doctors=a.data.doctors.slice(0),i.doctorArray=a.data.doctors.slice(0);for(let o=0;o<i.doctors.length;o++)if(i.doctors[o].specialityName===i.data.appointmentDetails.specialityName){i.specialist=i.doctors[o];break}for(let o=0;o<i.doctorArray.length;o++)if(i.doctorArray[o].doctorName===i.data.appointmentDetails.doctorName){i.doctor=i.doctorArray[o];break}}}).catch(a=>{})})()}getDoctorsArray(e,i){this.doctorArray.length=0,this.specialityCode=e,this.specialityName=i;for(let n=0;n<this.doctors.length;n++)e===this.doctors[n].specialityCode&&this.doctorArray.push(this.doctors[n])}getConsultationFee(e,i){var n=this;return(0,d.A)(function*(){const a="/doctor/?id="+e+"&hospitalCode="+i;yield n.httpService.get(a).then(o=>{o&&(n.consultation=o.data.consultationCharge,n.videoConsultation=o.data.videoConsultationCharge)}).catch(o=>{})})()}getCurrentDoctor(e){this.doctorId=e.doctorId,this.doctorName=e.doctorName,this.getConsultationFee(this.doctorId,this.hospitalCode),this.dateOfAppointment=null,this.timeOfAppointment=null,this.isVideo=!1,this.onChange(this.isVideo),this.fee=null,this.slots=void 0}getTimeSlot(){var e=this;return(0,d.A)(function*(){e.slots=void 0,e.timeOfAppointment=null,e.timeSlotEvening.length=0,e.timeSlotMorning.length=0,e.timeSlotAfternoon.length=0,e.timeSlotNight.length=0;const i="/appointment/slot/?hospitalCode="+e.data.appointmentDetails.hospital.code+"&doctorId="+e.data.appointmentDetails.doctorId+"&appointmentDate="+e.utilityService.toISODateTime(new Date(e.dateOfAppointment));yield e.httpService.get(i).then(n=>{if(null!=n){if(n.data.Evening){for(let a=0;a<n.data.Evening.length;a++)!0===n.data.Evening[a].available&&e.timeSlotEvening.push(n.data.Evening[a]);for(let a=0;a<e.timeSlotEvening.length;a++)e.timeSlotEvening[a].time===e.data.appointmentDetails.appointmentTime&&(e.timeOfAppointment=e.timeSlotEvening[a])}if(n.data.Night){for(let a=0;a<n.data.Night.length;a++)!0===n.data.Night[a].available&&(e.timeSlotNight=n.data.Night,e.timeSlotEvening.push(n.data.Night[a]));for(let a=0;a<e.timeSlotNight.length;a++)e.timeSlotNight[a].time===e.data.appointmentDetails.appointmentTime&&(e.timeOfAppointment=e.timeSlotNight[a])}if(n.data.Afternoon){for(let a=0;a<n.data.Afternoon.length;a++)!0===n.data.Afternoon[a].available&&e.timeSlotAfternoon.push(n.data.Afternoon[a]);for(let a=0;a<e.timeSlotAfternoon.length;a++)e.timeSlotAfternoon[a].time===e.data.appointmentDetails.appointmentTime&&(e.timeOfAppointment=e.timeSlotAfternoon[a])}if(n.data.Morning){for(let a=0;a<n.data.Morning.length;a++)!0===n.data.Morning[a].available&&(e.timeSlotMorning=n.data.Morning,e.timeSlotMorning.push(n.data.Morning[a]));for(let a=0;a<e.timeSlotMorning.length;a++)e.timeSlotMorning[a].time===e.data.appointmentDetails.appointmentTime&&(e.timeOfAppointment=e.timeSlotMorning[a])}}else e.utilityService.presentAlert("No Slots Available","Check for a different slot or date."),e.timeSlot()}).catch(n=>{e.utilityService.presentAlert("Try Again","Time slots not fetched.")})})()}getTime(e){this.timeSlot=e,this.fee=this.consultation?this.consultation.price:this.videoConsultation.price,this.consultationType=this.consultation?this.consultation.chargeName:this.videoConsultation.chargeName,this.consultationCode=this.consultation?this.consultation.code:this.videoConsultation.code}onChange(e){this.isVideo=e,!0===this.isVideo?(this.fee=this.videoConsultation.price,this.consultationType=this.videoConsultation.name,this.consultationCode=this.videoConsultation.code):(this.getConsultationFee(this.data.appointmentDetails.doctorId,this.data.appointmentDetails.hospital.code),this.fee=this.consultation.price,this.consultationType=this.consultation.name,this.consultationCode=this.consultation.code)}onRadioSelected(e){"Morning"===e?(this.timeSlotArray=[],this.timeSlotArray=this.timeSlotMorning):"Afternoon"===e?(this.timeSlotArray=[],this.timeSlotArray=this.timeSlotAfternoon):(this.timeSlotArray=[],this.timeSlotArray=this.timeSlotEvening)}editAppointment(){var e=this;return(0,d.A)(function*(){if(void 0===e.timeSlot)e.dialogRef.close(),e.utilityService.presentAlert("Invalid Input","Enter a valid time slot.");else{e.data.appointmentDetails.consultationCharge={chargeName:e.consultationType,price:e.fee,code:e.consultationCode},e.data.appointmentDetails.hospital.code=e.hospitalCode,e.data.appointmentDetails.hospital.id=e.hospitalId,e.data.appointmentDetails.hospital.name=e.hospitalName,e.data.appointmentDetails.specialityCode=e.specialityCode,e.data.appointmentDetails.specialityName=e.specialityName,e.data.appointmentDetails.videoConsultation=e.isVideo,e.data.appointmentDetails.doctorName=e.doctorName,e.data.appointmentDetails.doctorId=e.doctorId,e.data.appointmentDetails.appointmentDate=e.utilityService.toISODateTime(new Date(e.dateOfAppointment)),e.data.appointmentDetails.appointmentTime=e.timeSlot,e.dialogRef.close();const i="/appointment/"+e.data.appointmentDetails._id;yield e.httpService.put(i,e.data.appointmentDetails).then(n=>{null!=n?e.router.navigate(["/home/appointment-list"]):e.utilityService.presentAlert("Try Again","Appointment not updated successfully.")}).catch(n=>{e.utilityService.presentAlert("Try Again","Appointment not updated.")})}})()}ngOnInit(){}}return(s=c).\u0275fac=function(e){return new(e||s)(t.rXU(u.Vh),t.rXU(u.CP),t.rXU(_.Q),t.rXU(E.k),t.rXU(M.Ix))},s.\u0275cmp=t.VBU({type:s,selectors:[["app-appointment-modification"]],standalone:!0,features:[t.Jv_([{provide:f.MJ,useClass:U},{provide:f.de,useValue:B}]),t.aNF],decls:76,vars:19,consts:[["picker",""],[1,"rowEqualDistribution"],[1,"display-full-width"],["name","hospital",3,"ngModelChange","ngModel"],[3,"value","click",4,"ngFor","ngForOf"],[4,"ngIf"],["name","specialist",3,"ngModelChange","ngModel"],["name","doctor",3,"ngModelChange","ngModel"],["hideRequiredMarker","",1,"display-full-width"],["matInput","","placeholder","Date of Appointment","name","dob","autocomplete","off","required","","readonly","true",3,"ngModelChange","matDatepicker","min","ngModel"],["matIconSuffix","",3,"for"],["name","gender","required","",1,"radio-group",3,"ngModelChange","ngModel"],["value","Morning","required","",1,"radio-button",3,"change"],["value","Afternoon","required","",1,"radio-button",3,"change"],["value","Evening","required","",1,"radio-button",3,"change"],["name","timeOfAppointment",3,"ngModelChange","ngModel"],["name","isVideo","color","primary",3,"change","ngModelChange","ngModel"],[1,"fa","fa-inr"],["no-border","",1,"ion-no-padding"],["size","6"],["expand","block",1,"button-secondary",3,"click"],["expand","block","translucent","",1,"button-cancel",3,"mat-dialog-close"],[3,"click","value"]],template:function(e,i){if(1&e){const n=t.RV6();t.j41(0,"ion-toolbar")(1,"h5"),t.EFF(2,"Edit Appointment"),t.k0s()(),t.j41(3,"mat-dialog-content")(4,"form")(5,"ion-grid")(6,"ion-row",1)(7,"ion-col")(8,"mat-form-field",2)(9,"mat-label"),t.EFF(10,"Select Hospital"),t.k0s(),t.j41(11,"mat-select",3),t.mxI("ngModelChange",function(o){return t.eBV(n),t.DH7(i.hospital,o)||(i.hospital=o),t.Njj(o)}),t.DNE(12,S,2,2,"mat-option",4),t.k0s(),t.DNE(13,N,2,0,"mat-error",5),t.k0s()()(),t.j41(14,"ion-row",1)(15,"ion-col")(16,"mat-form-field",2)(17,"mat-label"),t.EFF(18,"Select Speciality"),t.k0s(),t.j41(19,"mat-select",6),t.mxI("ngModelChange",function(o){return t.eBV(n),t.DH7(i.specialist,o)||(i.specialist=o),t.Njj(o)}),t.DNE(20,j,2,2,"mat-option",4),t.nI1(21,"filter"),t.k0s()()()(),t.j41(22,"ion-row",1)(23,"ion-col")(24,"mat-form-field",2)(25,"mat-label"),t.EFF(26,"Select Doctor"),t.k0s(),t.j41(27,"mat-select",7),t.mxI("ngModelChange",function(o){return t.eBV(n),t.DH7(i.doctor,o)||(i.doctor=o),t.Njj(o)}),t.DNE(28,F,2,2,"mat-option",4),t.k0s()()()(),t.j41(29,"ion-row",1)(30,"ion-col")(31,"mat-form-field",8)(32,"input",9),t.mxI("ngModelChange",function(o){return t.eBV(n),t.DH7(i.dateOfAppointment,o)||(i.dateOfAppointment=o),t.Njj(o)}),t.bIt("ngModelChange",function(){return t.eBV(n),t.Njj(i.getTimeSlot())}),t.k0s(),t.nrm(33,"mat-datepicker-toggle",10)(34,"mat-datepicker",null,0),t.k0s()()(),t.j41(36,"ion-row",1)(37,"ion-col")(38,"mat-label"),t.EFF(39,"Time Slot Session"),t.k0s(),t.nrm(40,"br"),t.j41(41,"mat-radio-group",11),t.mxI("ngModelChange",function(o){return t.eBV(n),t.DH7(i.slots,o)||(i.slots=o),t.Njj(o)}),t.j41(42,"mat-radio-button",12),t.bIt("change",function(o){return t.eBV(n),t.Njj(i.onRadioSelected(o.value))}),t.j41(43,"span"),t.EFF(44,"Morning"),t.k0s()(),t.j41(45,"mat-radio-button",13),t.bIt("change",function(o){return t.eBV(n),t.Njj(i.onRadioSelected(o.value))}),t.j41(46,"span"),t.EFF(47,"Afternoon"),t.k0s()(),t.j41(48,"mat-radio-button",14),t.bIt("change",function(o){return t.eBV(n),t.Njj(i.onRadioSelected(o.value))}),t.j41(49,"span"),t.EFF(50,"Evening"),t.k0s()()()()(),t.j41(51,"ion-row",1)(52,"ion-col")(53,"mat-form-field",8)(54,"mat-label"),t.EFF(55,"Select Time"),t.k0s(),t.j41(56,"mat-select",15),t.mxI("ngModelChange",function(o){return t.eBV(n),t.DH7(i.timeOfAppointment,o)||(i.timeOfAppointment=o),t.Njj(o)}),t.DNE(57,b,2,2,"mat-option",4),t.k0s(),t.DNE(58,k,2,0,"mat-error",5),t.k0s()()(),t.j41(59,"ion-row",1)(60,"ion-col")(61,"mat-checkbox",16),t.bIt("change",function(o){return t.eBV(n),t.Njj(i.onChange(o.checked))}),t.mxI("ngModelChange",function(o){return t.eBV(n),t.DH7(i.isVideo,o)||(i.isVideo=o),t.Njj(o)}),t.EFF(62," Request Video Consultation"),t.k0s(),t.nrm(63,"br"),t.j41(64,"span"),t.EFF(65," Charge: "),t.nrm(66,"i",17),t.EFF(67),t.k0s()()()()()(),t.j41(68,"ion-footer",18)(69,"ion-row")(70,"ion-col",19)(71,"ion-button",20),t.bIt("click",function(){return t.eBV(n),t.Njj(i.editAppointment())}),t.EFF(72," Save "),t.k0s()(),t.j41(73,"ion-col",19)(74,"ion-button",21),t.EFF(75," Close "),t.k0s()()()()}if(2&e){const n=t.sdS(35);t.R7$(11),t.R50("ngModel",i.hospital),t.R7$(),t.Y8G("ngForOf",i.hospitals),t.R7$(),t.Y8G("ngIf",!0),t.R7$(6),t.R50("ngModel",i.specialist),t.R7$(),t.Y8G("ngForOf",t.bMT(21,17,i.doctors)),t.R7$(7),t.R50("ngModel",i.doctor),t.R7$(),t.Y8G("ngForOf",i.doctorArray),t.R7$(4),t.Y8G("matDatepicker",n)("min",i.minAppointmentDate),t.R50("ngModel",i.dateOfAppointment),t.R7$(),t.Y8G("for",n),t.R7$(8),t.R50("ngModel",i.slots),t.R7$(15),t.R50("ngModel",i.timeOfAppointment),t.R7$(),t.Y8G("ngForOf",i.timeSlotArray),t.R7$(),t.Y8G("ngIf",!0),t.R7$(3),t.R50("ngModel",i.isVideo),t.R7$(6),t.JRh(i.fee)}},dependencies:[m.bv,m.Jm,m.hU,m.M0,m.lO,m.ln,m.ai,u.Yi,h.YN,h.qT,h.me,h.BC,h.cb,h.YS,h.vS,h.cV,y.rl,y.nJ,p.VO,A.pM,f.wT,A.bT,y.TL,C.fg,g.bZ,g.bU,y.yw,g.Vh,D.VT,D._g,O.So,u.tx,I],styles:[".display-full-width[_ngcontent-%COMP%]{width:100%}ion-row[_ngcontent-%COMP%]{padding:0}span[_ngcontent-%COMP%]{font-size:var(--mc-font-body-sm)}mat-label[_ngcontent-%COMP%]{font-size:var(--mc-font-form-label)}.rowEqualDistribution[_ngcontent-%COMP%]{height:55px}.radio-group[_ngcontent-%COMP%]{display:flex;flex-direction:row;margin:auto}.radio-button[_ngcontent-%COMP%]{padding:5% .5% .5%;margin-right:1%}mat-dialog-content[_ngcontent-%COMP%]{border-radius:var(--mc-radius-sm);padding-left:var(--mc-spacing-xs);padding-right:var(--mc-spacing-xs);box-sizing:border-box;overflow-x:hidden}*[_ngcontent-%COMP%]{color:var(--mc-text-primary)}ion-footer[_ngcontent-%COMP%]{margin-top:var(--mc-spacing-md)}"]}),c})()},3226:(R,P,l)=>{l.d(P,{j:()=>T});var d=l(4438),u=l(9934),f=l(8023),A=l(7793),v=l(9012);let T=(()=>{var m;class h{constructor(p,C,g,D){this.utilityService=p,this.httpService=C,this.paymentGatewayService=g,this.router=D,this.paymentType=3}makePayment(p,C,g){this.appointment=p,p.paymentDetails.upi&&(this.paymentType=p.paymentDetails.gatewayKey?3:1),p.paymentDetails.gatewayKey&&(this.paymentType=p.paymentDetails.upi?3:2),this.successCallbackFun=C,this.cancelCallbackFun=g,null!=p.paymentDetails.gatewayKey||null!=p.paymentDetails.upi?this.paymentGatewayService.makePayment({paymentGatewayKey:p.paymentDetails.gatewayKey,orderId:p._id,payerEmail:p.patient.email,payerName:p.patient.name,payerPhoneNumber:p.patient.phone,appName:"medics",amount:p.consultationCharge.price,description:p.consultationCharge.chargeName,upi:p.paymentDetails.upi?p.paymentDetails.upi:{name:"",id:""},paymentType:this.paymentType},_=>{this.appointment.paymentTransactionNo=_.razorpay_payment_id,this.appointment.paymentDetails.successResponse=_,this.httpService.put("/appointment/"+this.appointment._id+"/confirm",this.appointment).then(M=>{M||this.utilityService.presentAlert("Appointment not confirmed.","Your appointment is not confirmed due to some technical issue. Please contact the hospital with your payment details."),this.successCallbackFun(this.appointment)}).catch(M=>{this.utilityService.presentAlert("Appointment not confirmed.","Your appointment is not confirmed due to some technical issue. Please contact the hospital with your payment details."),this.router.navigate(["/home/appointment-details"],{state:{appointmentDetails:this.appointment}})})},_=>{console.log("Payment failed. "+_.description+" (Error "+_.code+")"),this.appointment.paymentDetails.errorResponse=_,this.utilityService.presentAlert("Payment Failed","Your payment against the appointment has failed. Please try again."),this.httpService.put("/appointment/"+this.appointment._id+"/paymentFailed",this.appointment).then(M=>{this.cancelCallbackFun(this.appointment)}).catch(M=>{})}):this.utilityService.presentAlert("Missing Payment Gateway Details","Payment gateway details are not configured for this hospital.")}}return(m=h).\u0275fac=function(p){return new(p||m)(d.KVO(u.Q),d.KVO(f.k),d.KVO(A.W),d.KVO(v.Ix))},m.\u0275prov=d.jDH({token:m,factory:m.\u0275fac,providedIn:"root"}),h})()}}]);